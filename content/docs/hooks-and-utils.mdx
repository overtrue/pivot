---
title: Hooks å’Œå·¥å…·å‡½æ•°
description: Pivot æä¾›çš„å¼ºå¤§ React Hooks å’Œå·¥å…·å‡½æ•°åº“ï¼Œç®€åŒ– OpenAPI æ•°æ®å¤„ç†ã€‚
---

Pivot ä¸ä»…æä¾›äº†ä¸°å¯Œçš„ç»„ä»¶ï¼Œè¿˜å†…ç½®äº†ä¸€å¥—å¼ºå¤§çš„ **React Hooks** å’Œ **å·¥å…·å‡½æ•°**ï¼Œä¸“é—¨ç”¨äºå¤„ç† OpenAPI è§„èŒƒæ•°æ®ã€‚è¿™äº›å·¥å…·è®©æ‚¨èƒ½å¤Ÿè½»æ¾åœ°è§£æã€å¤„ç†å’Œæ“ä½œ OpenAPI æ•°æ®ç»“æ„ã€‚

## ğŸ£ React Hooks

### useOpenApi

æœ€æ ¸å¿ƒçš„ Hookï¼Œæä¾›äº†å¤„ç† OpenAPI è§„èŒƒçš„å®Œæ•´åŠŸèƒ½ã€‚

```tsx
import { useOpenApi } from "@/lib/hooks/use-openapi";
import type { OpenAPIV3 } from "openapi-types";

function ApiComponent({ spec }: { spec: OpenAPIV3.Document }) {
  const openApi = useOpenApi(spec);

  // è·å–æŒ‰æ ‡ç­¾åˆ†ç»„çš„æ“ä½œ
  const operationsByTag = openApi.getOperationsByTag();

  // è§£æå¼•ç”¨
  const resolved = openApi.resolve(someReference, "schemas");

  // è·å–æ¨¡å¼ç±»å‹
  const type = openApi.getSchemaType(schema);

  // å¤„ç†å‚æ•°
  const processedParams = openApi.processParameters(parameters);

  return (
    <div>
      {Object.entries(operationsByTag).map(([tag, operations]) => (
        <div key={tag}>
          <h3>{tag}</h3>
          {operations.map((op) => (
            <div key={op.path + op.method}>
              {op.method} {op.path}
            </div>
          ))}
        </div>
      ))}
    </div>
  );
}
```

#### ä¸»è¦åŠŸèƒ½

- **æ“ä½œå¤„ç†**ï¼š`getOperationsByTag()`ã€`getOperation(path, method)`
- **æ¨¡å¼å¤„ç†**ï¼š`getSchemaType()`ã€`getSchemaProperties()`ã€`getSchemaConstraints()`
- **å¼•ç”¨è§£æ**ï¼š`resolve()`
- **å‚æ•°å¤„ç†**ï¼š`processParameters()`ã€`getRequestBodySchema()`
- **å“åº”å¤„ç†**ï¼š`processResponse()`
- **åŸºæœ¬ä¿¡æ¯**ï¼š`getInfo()`ã€`getServers()`ã€`getTags()`ã€`getComponents()`

### useOperation

ä¸“é—¨å¤„ç†å•ä¸ª API æ“ä½œçš„ Hookã€‚

```tsx
import { useOperation } from "@/lib/hooks/use-operation";

function OperationComponent({ operation, path, method }) {
  const op = useOperation(operation, path, method);

  const operationId = op.getOperationId();
  const tags = op.getTags();
  const parameters = op.getParameters();
  const requestBody = op.getRequestBody();
  const responses = op.getResponses();
  const security = op.getSecurity();

  return (
    <div>
      <h3>{operationId}</h3>
      <div>Tags: {tags.join(", ")}</div>
      <div>Parameters: {parameters.length}</div>
    </div>
  );
}
```

### useSchema

å¤„ç† OpenAPI Schema å¯¹è±¡çš„ä¸“ç”¨ Hookã€‚

```tsx
import { useSchema } from "@/lib/hooks/use-schema";

function SchemaComponent({ schema, components }) {
  const schemaData = useSchema(schema, components);

  const type = schemaData.getType();
  const properties = schemaData.getProperties();

  const isNameRequired = schemaData.isRequired("name");
  const isEmailRequired = schemaData.isRequired("email");

  return (
    <div>
      <div>Type: {type}</div>
      <div>Properties:</div>
      {Object.entries(properties).map(([key, prop]) => (
        <div key={key}>
          {key}: {schemaData.isRequired(key) ? "Required" : "Optional"}
        </div>
      ))}
    </div>
  );
}
```

## ğŸ› ï¸ å·¥å…·å‡½æ•°

### resolveRef

è§£æ OpenAPI ä¸­çš„ `$ref` å¼•ç”¨ã€‚

```tsx
import { resolveRef } from "@/lib/utils/resolve-ref";
import type { OpenAPIV3 } from "openapi-types";

// è§£æ Schema å¼•ç”¨
const resolvedSchema = resolveRef<OpenAPIV3.SchemaObject>(
  { $ref: "#/components/schemas/User" },
  components,
  "schemas"
);

// è§£æå‚æ•°å¼•ç”¨
const resolvedParam = resolveRef<OpenAPIV3.ParameterObject>(
  { $ref: "#/components/parameters/PageSize" },
  components,
  "parameters"
);

// è§£æå“åº”å¼•ç”¨
const resolvedResponse = resolveRef<OpenAPIV3.ResponseObject>(
  { $ref: "#/components/responses/NotFound" },
  components,
  "responses"
);
```

#### ç‰¹æ€§

- **è‡ªåŠ¨è§£æåµŒå¥—å¼•ç”¨**ï¼šæ”¯æŒå¼•ç”¨çš„å¼•ç”¨
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
- **é”™è¯¯å¤„ç†**ï¼šä¼˜é›…å¤„ç†æ— æ•ˆå¼•ç”¨
- **åˆ†ç±»è§£æ**ï¼šæ”¯æŒä¸åŒç±»å‹çš„ç»„ä»¶å¼•ç”¨

### generateExample

æ ¹æ® OpenAPI Schema è‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹æ•°æ®ã€‚

```tsx
import { generateExample } from "@/lib/utils/generate-example";

// åŸºæœ¬ç”¨æ³•
const example = generateExample(schema, components);

// é«˜çº§é…ç½®
const example = generateExample(schema, components, {
  maxDepth: 3, // æœ€å¤§é€’å½’æ·±åº¦
  includeReadOnly: false, // æ˜¯å¦åŒ…å«åªè¯»å±æ€§
  includeWriteOnly: true, // æ˜¯å¦åŒ…å«åªå†™å±æ€§
});
```

#### æ”¯æŒçš„æ•°æ®ç±»å‹

- **åŸºç¡€ç±»å‹**ï¼šstringã€numberã€integerã€boolean
- **å¤æ‚ç±»å‹**ï¼šobjectã€array
- **å¤åˆæ¨¡å¼**ï¼šallOfã€oneOfã€anyOf
- **æ ¼å¼åŒ–å­—ç¬¦ä¸²**ï¼šdateã€date-timeã€emailã€uuidã€url ç­‰
- **çº¦æŸæ¡ä»¶**ï¼šenumã€patternã€min/max ç­‰

#### æ™ºèƒ½ç”Ÿæˆ

æ ¹æ®å±æ€§åè‡ªåŠ¨ç”Ÿæˆåˆé€‚çš„ç¤ºä¾‹ï¼š

```tsx
// è‡ªåŠ¨è¯†åˆ«å¸¸è§å­—æ®µ
{
  "name": "å¼ ä¸‰",           // è¯†åˆ«å§“åå­—æ®µ
  "email": "user@example.com", // è¯†åˆ«é‚®ç®±å­—æ®µ
  "phone": "+1-555-0123",   // è¯†åˆ«ç”µè¯å­—æ®µ
  "address": "123 Main St", // è¯†åˆ«åœ°å€å­—æ®µ
  "company": "Acme Corp",   // è¯†åˆ«å…¬å¸å­—æ®µ
  "website": "https://example.com" // è¯†åˆ«ç½‘ç«™å­—æ®µ
}
```

### schema-utils

Schema å¤„ç†çš„è¾…åŠ©å·¥å…·å‡½æ•°ã€‚

```tsx
import {
  isReferenceObject,
  isSchemaObjectNotRef,
  getSchemaType,
  isPropertyRequired,
} from "@/lib/utils/schema-utils";

// ç±»å‹æ£€æŸ¥
if (isReferenceObject(obj)) {
  console.log("è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å¯¹è±¡");
}

if (isSchemaObjectNotRef(obj)) {
  console.log("è¿™æ˜¯ä¸€ä¸ª Schema å¯¹è±¡");
}

// è·å–ç±»å‹
const type = getSchemaType(schema); // "object", "array", "allOf" ç­‰

// æ£€æŸ¥å¿…å¡«å±æ€§
const required = isPropertyRequired(schema, "email");
```

## ğŸŒ å›½é™…åŒ–ç³»ç»Ÿ

### useI18n Hook

å®Œæ•´çš„å›½é™…åŒ–æ”¯æŒï¼Œå†…ç½®ä¸­è‹±æ–‡ç¿»è¯‘ã€‚

```tsx
import { useI18n } from "@/registry/lib/i18n/";

function MyComponent() {
  const { t, locale, setLocale } = useI18n();

  return (
    <div>
      <h1>{t("api.title")}</h1>
      <p>{t("operation.parameters")}</p>

      <button onClick={() => setLocale("zh")}>ä¸­æ–‡</button>
      <button onClick={() => setLocale("en")}>English</button>

      <div>Current locale: {locale}</div>
    </div>
  );
}
```

### ç‹¬ç«‹ç¿»è¯‘å‡½æ•°

```tsx
import { t, createTranslator } from "@/registry/lib/i18n/";

// ä½¿ç”¨é»˜è®¤ç¿»è¯‘å‡½æ•°ï¼ˆè‹±æ–‡ï¼‰
const title = t("api.title");

// åˆ›å»ºç‰¹å®šè¯­è¨€çš„ç¿»è¯‘å‡½æ•°
const zhTranslator = createTranslator("zh");
const chineseTitle = zhTranslator("api.title");
```

### I18nProvider

åœ¨åº”ç”¨æ ¹éƒ¨åŒ…è£…ä»¥å¯ç”¨è¯­è¨€åˆ‡æ¢åŠŸèƒ½ã€‚

```tsx
import { I18nProvider } from "@/registry/lib/i18n/";

function App() {
  return (
    <I18nProvider>
      <YourApp />
    </I18nProvider>
  );
}
```

## ğŸ“¦ å®‰è£…å’Œä½¿ç”¨

### å®‰è£… Hooks

```bash
npx shadcn@latest add https://pivotkit.vercel.app/registry.json hooks
```

### å®‰è£…å·¥å…·å‡½æ•°

```bash
# å¼•ç”¨è§£æå·¥å…·
npx shadcn@latest add https://pivotkit.vercel.app/registry.json resolve-ref

# ç¤ºä¾‹ç”Ÿæˆå·¥å…·
npx shadcn@latest add https://pivotkit.vercel.app/registry.json generate-example

# å›½é™…åŒ–ç³»ç»Ÿ
npx shadcn@latest add https://pivotkit.vercel.app/registry.json i18n
```

### å¯¼å…¥å’Œä½¿ç”¨

```tsx
// Hooks
import { useOpenApi } from "@/lib/hooks/use-openapi";
import { useOperation } from "@/lib/hooks/use-operation";
import { useSchema } from "@/lib/hooks/use-schema";

// å·¥å…·å‡½æ•°
import { resolveRef } from "@/lib/utils/resolve-ref";
import { generateExample } from "@/lib/utils/generate-example";

// å›½é™…åŒ–
import { useI18n, t } from "@/registry/lib/i18n/";
```

## ğŸ”„ ä¸ç»„ä»¶çš„é›†æˆ

è¿™äº›å·¥å…·ä¸ Pivot ç»„ä»¶æ— ç¼é›†æˆï¼š

```tsx
import { useOpenApi } from "@/lib/hooks/use-openapi";
import { StatusCode } from "@/components/pivot/status-code";
import { MethodLabel } from "@/components/pivot/method-label";
import { ParameterItem } from "@/components/pivot/parameter-item";

function ApiEndpoint({ spec, path, method }) {
  const openApi = useOpenApi(spec);
  const operation = openApi.getOperation(path, method);
  const parameters = openApi.processParameters(operation?.parameters);

  return (
    <div>
      {/* ä½¿ç”¨ç»„ä»¶æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯ */}
      <div className="flex items-center gap-2">
        <MethodLabel method={method} />
        <code>{path}</code>
      </div>

      {/* æ˜¾ç¤ºå‚æ•° */}
      <div className="space-y-2">
        {parameters.query?.map((param, index) => (
          <ParameterItem
            key={index}
            parameter={param}
            components={openApi.getComponents()}
          />
        ))}
      </div>

      {/* æ˜¾ç¤ºå“åº”çŠ¶æ€ç  */}
      <div className="flex gap-1">
        {Object.keys(operation?.responses || {}).map((status) => (
          <StatusCode key={status} code={parseInt(status)} />
        ))}
      </div>
    </div>
  );
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–

```tsx
// ä½¿ç”¨ useMemo ç¼“å­˜å¤æ‚è®¡ç®—
const operations = useMemo(() => {
  return openApi.getOperationsByTag();
}, [openApi]);
```

### 2. é”™è¯¯å¤„ç†

```tsx
// å§‹ç»ˆæ£€æŸ¥è§£æç»“æœ
const resolved = openApi.resolve(reference);
if (!resolved) {
  console.warn("æ— æ³•è§£æå¼•ç”¨:", reference);
  return <div>å¼•ç”¨è§£æå¤±è´¥</div>;
}
```

### 3. ç±»å‹å®‰å…¨

```tsx
// ä½¿ç”¨æ­£ç¡®çš„ TypeScript ç±»å‹
const schema = resolveRef<OpenAPIV3.SchemaObject>(
  schemaRef,
  components,
  "schemas"
);
```

è¿™å¥—å·¥å…·ç³»ç»Ÿè®©æ‚¨èƒ½å¤Ÿè½»æ¾å¤„ç†å¤æ‚çš„ OpenAPI æ•°æ®ç»“æ„ï¼Œè€Œæ— éœ€ä»é›¶å¼€å§‹ç¼–å†™è§£æé€»è¾‘ã€‚ç»“åˆ Pivot çš„ç»„ä»¶åº“ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæ„å»ºåŠŸèƒ½å®Œæ•´çš„ API æ–‡æ¡£ç•Œé¢ã€‚

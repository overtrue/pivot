---
title: Try It Out Panel
description: 功能完整的 API 试用面板组件，支持参数配置、认证、请求发送和响应展示。
component: true
---

Try It Out Panel 是一个功能完整的 API 试用面板组件，它允许用户直接在文档中测试 API 端点。组件支持参数配置、多种认证方式、请求发送和响应展示，为开发者提供便捷的 API 测试体验。

<ComponentPreview name="try-it-out-panel-demo" />

## 安装

```bash
npx shadcn@latest add https://pivotkit.vercel.app/r/try-it-out-panel.json
```

## 使用方法

```tsx
import { TryItOutPanel } from "@/components/pivot/try-it-out-panel";
import type { OpenAPIV3 } from "openapi-types";

// 基本用法
<TryItOutPanel
  operation={operationObject}
  method="POST"
  path="/api/users"
  baseUrl="https://api.example.com"
  components={components}
/>

// 可折叠模式
<TryItOutPanel
  operation={operationObject}
  method="GET"
  path="/api/users/{id}"
  baseUrl="https://api.example.com"
  components={components}
  collapsible={true}
  className="h-full"
/>
```

## 示例

### 基本用法

```tsx
import { TryItOutPanel } from "@/components/pivot/try-it-out-panel";

const operation = {
  operationId: "createUser",
  summary: "创建用户",
  parameters: [
    {
      name: "id",
      in: "path",
      required: true,
      schema: { type: "integer" },
      description: "用户ID"
    }
  ],
  requestBody: {
    required: true,
    content: {
      "application/json": {
        schema: {
          type: "object",
          properties: {
            name: { type: "string" },
            email: { type: "string" }
          }
        }
      }
    }
  },
  responses: {
    "201": {
      description: "用户创建成功"
    }
  }
};

<TryItOutPanel
  operation={operation}
  method="POST"
  path="/api/users/{id}"
  baseUrl="https://api.example.com"
/>
```

### 带认证的 API 测试

```tsx
const operationWithAuth = {
  // ... 操作定义
  security: [
    { bearerAuth: [] },
    { apiKeyAuth: [] }
  ]
};

<TryItOutPanel
  operation={operationWithAuth}
  method="GET"
  path="/api/protected/users"
  baseUrl="https://api.example.com"
  components={{
    securitySchemes: {
      bearerAuth: {
        type: "http",
        scheme: "bearer",
        bearerFormat: "JWT"
      },
      apiKeyAuth: {
        type: "apiKey",
        in: "header",
        name: "X-API-Key"
      }
    }
  }}
/>
```

### 在布局中使用

```tsx
import { OperationDetailedLayout } from "@/components/pivot/operation-detailed-layout";

// Try It Out Panel 会自动集成到 OperationDetailedLayout 中
<OperationDetailedLayout
  spec={openApiSpec}
  selectedPath="/api/users/{id}"
  selectedMethod="GET"
/>
```

## API 参考

### Props

| 属性          | 类型                        | 默认值 | 描述                                    |
| ------------- | --------------------------- | ------ | --------------------------------------- |
| `operation`   | `OpenAPIV3.OperationObject` | -      | OpenAPI 操作对象（必需）                 |
| `method`      | `string`                    | -      | HTTP 方法（必需）                       |
| `path`        | `string`                    | -      | API 路径（必需）                        |
| `baseUrl`     | `string`                    | `""`   | 基础 URL                               |
| `components`  | `OpenAPIV3.ComponentsObject` | -      | OpenAPI 组件定义                       |
| `className`   | `string`                    | -      | 额外的 CSS 类名                        |
| `collapsible` | `boolean`                   | `false` | 是否可折叠                            |

### 支持的认证方式

组件支持以下 OpenAPI 安全方案：

1. **HTTP Basic Auth** - 用户名和密码认证
2. **HTTP Bearer Auth** - JWT 或 OAuth2 令牌认证
3. **API Key** - 头部、查询参数或 Cookie 中的 API 密钥
4. **OAuth2** - OAuth2 流程认证
5. **OpenID Connect** - OpenID Connect 认证

## 功能特性

### 参数处理

- **路径参数** - 自动识别和填充路径中的参数
- **查询参数** - 支持查询字符串参数配置
- **头部参数** - 自定义请求头部
- **Cookie 参数** - 设置 Cookie 值

### 请求体支持

- **JSON 格式** - 支持 JSON 请求体编辑
- **表单数据** - 支持 multipart/form-data
- **XML 格式** - 支持 XML 请求体
- **原始文本** - 支持纯文本请求体

### 响应展示

- **状态码** - 显示 HTTP 状态码和状态文本
- **响应头** - 展示所有响应头部信息
- **响应体** - 格式化显示响应内容
- **时间信息** - 显示请求耗时

### 认证管理

- **多方案支持** - 支持多种认证方案
- **状态持久化** - 认证状态在会话中保持
- **动态切换** - 支持运行时切换认证方案

## 组件状态

Try It Out Panel 维护以下内部状态：

- **参数值** - 用户输入的参数值
- **请求体** - 用户输入的请求体内容
- **认证状态** - 当前使用的认证信息
- **请求状态** - 加载、成功、错误等状态
- **响应数据** - 最新的响应信息
- **折叠状态** - 面板的展开/折叠状态

## 最佳实践

### 1. 提供完整的组件定义

```tsx
// 推荐：提供完整的组件定义以支持引用解析
<TryItOutPanel
  operation={operation}
  method="GET"
  path="/api/users/{id}"
  components={{
    parameters: {
      UserId: {
        name: "id",
        in: "path",
        required: true,
        schema: { type: "integer" }
      }
    },
    securitySchemes: {
      bearerAuth: {
        type: "http",
        scheme: "bearer"
      }
    }
  }}
/>

// 不推荐：缺少组件定义
<TryItOutPanel
  operation={operation}
  method="GET"
  path="/api/users/{id}"
/>
```

### 2. 处理错误状态

```tsx
// 组件会自动处理网络错误，但你可以提供更好的用户体验
function ApiTestPage() {
  const [operation, setOperation] = useState(null);
  const [error, setError] = useState(null);

  if (error) {
    return (
      <div className="p-4 border border-red-200 bg-red-50 rounded">
        <h3 className="text-red-800 font-medium">加载失败</h3>
        <p className="text-red-600 text-sm">{error.message}</p>
      </div>
    );
  }

  return (
    <TryItOutPanel
      operation={operation}
      method="GET"
      path="/api/users"
      onError={(error) => {
        console.error('API test error:', error);
        // 可以发送到错误监控服务
        errorReporting.captureException(error);
      }}
    />
  );
}
```

### 3. 自定义样式和布局

```tsx
<TryItOutPanel
  operation={operation}
  method="POST"
  path="/api/users"
  className="border-2 border-blue-200 rounded-lg p-4"
  style={{
    '--panel-bg': 'var(--color-blue-50)',
    '--panel-border': 'var(--color-blue-200)'
  }}
/>
```

## 无障碍性

- 支持键盘导航
- 屏幕阅读器友好
- 高对比度主题支持
- 可访问的表单控件

## 性能优化

- 懒加载响应内容
- 智能参数验证
- 请求去重和缓存
- 响应式状态管理

## 安全考虑

- 不在客户端存储敏感认证信息
- 支持 CORS 配置
- 请求头验证
- 响应内容安全检查

---
title: Operation Detail
description: 用于展示 OpenAPI 操作详细信息的组件，支持多种输入格式和智能引用解析。
component: true
---

Operation Detail 组件是一个功能强大的组件，用于展示 OpenAPI 操作的完整详细信息。它支持多种输入格式，包括直接的操作对象、引用对象和部分操作对象，并提供了智能的引用解析和错误处理。

<ComponentPreview name="operation-detail-demo" />

## 安装

```bash
npx shadcn@latest add https://pivotkit.vercel.app/r/operation-detail.json
```

## 使用方法

```tsx
import { OperationDetail } from "@/components/pivot/operation-detail";
```

```tsx
<OperationDetail
  operation={operationObject}
  path="/api/users/{id}"
  method="GET"
  spec={openApiSpec}
  components={components}
/>
```

## 示例

### 基本用法

```tsx
import { OperationDetail } from "@/components/pivot/operation-detail";

const operation = {
  operationId: "getUserById",
  summary: "获取用户详情",
  description: "根据用户ID获取特定用户的详细信息",
  tags: ["Users", "Profile"],
  parameters: [
    {
      name: "id",
      in: "path",
      required: true,
      schema: { type: "integer", minimum: 1 },
      description: "用户唯一标识符"
    }
  ],
  responses: {
    "200": {
      description: "成功获取用户信息",
      content: {
        "application/json": {
          schema: {
            type: "object",
            properties: {
              id: { type: "integer" },
              name: { type: "string" },
              email: { type: "string" }
            }
          }
        }
      }
    }
  }
};

<OperationDetail
  operation={operation}
  path="/api/users/{id}"
  method="GET"
/>
```

### 使用 OpenAPI 规范

```tsx
import { OperationDetail } from "@/components/pivot/operation-detail";
import type { OpenAPIV3 } from "openapi-types";

const openApiSpec: OpenAPIV3.Document = {
  openapi: "3.0.0",
  info: { title: "User API", version: "1.0.0" },
  paths: {
    "/users/{id}": {
      get: {
        operationId: "getUserById",
        summary: "获取用户详情",
        // ... 其他操作详情
      }
    }
  },
  components: {
    // ... 组件定义
  }
};

<OperationDetail
  operation={openApiSpec.paths["/users/{id}"].get!}
  path="/users/{id}"
  method="GET"
  spec={openApiSpec}
  components={openApiSpec.components}
/>
```

### 处理引用对象

```tsx
// 当操作是引用对象时，组件会自动解析
const operationRef = {
  $ref: "#/components/operations/getUserById"
};

<OperationDetail
  operation={operationRef}
  path="/api/users/{id}"
  method="GET"
  spec={openApiSpec}
  components={openApiSpec.components}
/>
```

### 已弃用操作

```tsx
const deprecatedOperation = {
  operationId: "getUserByEmail",
  summary: "通过邮箱获取用户（已弃用）",
  description: "此端点已弃用，请使用 GET /users/{id}",
  deprecated: true,
  tags: ["Users"],
  // ... 其他属性
};

<OperationDetail
  operation={deprecatedOperation}
  path="/api/users/by-email"
  method="GET"
/>
```

## API 参考

### Props

| 属性          | 类型                                                                                    | 默认值 | 描述                                    |
| ------------- | --------------------------------------------------------------------------------------- | ------ | --------------------------------------- |
| `operation`   | `OpenAPIV3.OperationObject \| OpenAPIV3.ReferenceObject \| Partial<OpenAPIV3.OperationObject>` | -      | 操作对象，支持多种格式                   |
| `path`        | `string`                                                                                | -      | API 路径                               |
| `method`      | `string`                                                                                | -      | HTTP 方法                              |
| `components`  | `OpenAPIV3.ComponentsObject`                                                            | -      | OpenAPI 组件定义（可选）                |
| `spec`        | `OpenAPIV3.Document`                                                                    | -      | 完整的 OpenAPI 规范（可选）             |
| `className`   | `string`                                                                                | -      | 额外的 CSS 类名                        |

### 支持的 HTTP 方法

组件自动验证并标准化以下 HTTP 方法：

- **GET** - 获取资源
- **POST** - 创建资源
- **PUT** - 更新资源
- **DELETE** - 删除资源
- **PATCH** - 部分更新资源
- **OPTIONS** - 获取资源支持的方法
- **HEAD** - 获取资源头部信息

## 功能特性

### 智能引用解析

组件使用 `useOpenApi` hook 智能解析引用对象，支持：

- 自动解析 `$ref` 引用
- 回退到直接对象
- 优雅的错误处理

### 多格式支持

支持多种输入格式：

1. **完整操作对象** - 直接传入完整的操作定义
2. **引用对象** - 包含 `$ref` 的引用
3. **部分对象** - 不完整的操作定义

### 错误处理

当无法解析引用时，组件会显示友好的错误信息：

- 黄色警告边框
- 清晰的错误描述
- 有用的提示信息

### 国际化支持

组件使用 `useI18n` hook 支持多语言：

- 标签文本本地化
- 操作ID标签
- 错误消息本地化

## 组件结构

Operation Detail 组件包含以下主要部分：

1. **操作头部**
   - HTTP 方法和路径
   - 弃用标识（如果适用）
   - 操作摘要
   - 操作描述
   - 外部文档链接

2. **元数据**
   - 标签列表
   - 操作ID

3. **参数部分**
   - 路径参数
   - 查询参数
   - 头部参数
   - Cookie 参数

4. **请求体部分**
   - 请求体模式
   - 媒体类型
   - 示例数据

5. **响应部分**
   - 状态码
   - 响应描述
   - 响应模式
   - 响应示例

6. **安全要求**
   - 认证方案
   - 权限要求

## 最佳实践

### 1. 提供完整的上下文

```tsx
// 推荐：提供完整的 OpenAPI 规范
<OperationDetail
  operation={operation}
  path={path}
  method={method}
  spec={openApiSpec}
  components={openApiSpec.components}
/>

// 不推荐：缺少组件定义
<OperationDetail
  operation={operation}
  path={path}
  method={method}
/>
```

### 2. 处理引用对象

```tsx
// 当操作包含引用时，确保提供组件定义
const operationWithRef = {
  parameters: [
    { $ref: "#/components/parameters/UserId" }
  ]
};

<OperationDetail
  operation={operationWithRef}
  path="/api/users/{id}"
  method="GET"
  components={components} // 必需，用于解析引用
/>
```

### 3. 错误处理

```tsx
// 组件会自动处理解析错误，但你可以提供更好的用户体验
{operations.map((operation, index) => (
  <OperationDetail
    key={index}
    operation={operation}
    path={paths[index]}
    method={methods[index]}
    spec={spec}
    components={components}
  />
))}
```

## 无障碍性

- 支持屏幕阅读器
- 语义化的 HTML 结构
- 键盘导航支持
- 高对比度主题支持

## 性能优化

- 使用 `useMemo` 优化操作对象适配
- 智能引用解析避免重复计算
- 条件渲染减少不必要的 DOM 节点

## 设计原则

Operation Detail 组件遵循以下设计原则：

1. **渐进增强** - 支持从简单到复杂的各种使用场景
2. **错误容忍** - 优雅处理各种错误情况
3. **一致性** - 与整个 OpenAPI 组件库保持一致的设计语言
4. **可访问性** - 确保所有用户都能访问操作信息
5. **国际化** - 支持多语言环境
